# 前后端对接技术方案

## 1. 方案概述

本文档描述代码结构管理系统前后端对接的技术方案，使用命令行参数配置，包含前端API请求、开发模式启动和生产模式部署。

### 1.1 核心原则

* **命令行配置**：所有配置通过命令行参数传递

* **统一端口**：前后端通过同一端口访问

* **简单启动**：一条命令启动开发环境

### 1.2 技术栈

**前端：** React + TypeScript + Vite + Ant Design\
**后端：** Node.js + Express + TypeScript + YAML存储

## 2. 前端API请求功能

目前主要做前后端打通测试，因此只需要实现模块列表的获取API请求就可以，后续其他的接口之后再说，不在本次工作内

## 3. 开发模式启动

### 3.1 代理配置

Vite开发服务器配置API代理，将前端请求转发到后端服务器。

| 服务   | 默认端口 | 参数           |
| ---- | ---- | ------------ |
| 后端服务 | 3000 | --port       |
| 前端服务 | 5173 | --front-port |

### 3.2 并发启动

启动脚本同时启动前后端服务：

1. 启动后端API服务
2. 启动前端开发服务
3. 配置API代理

### 3.3 启动命令

**dev:web命令：**

* 使用默认端口启动（后端3000，前端5173）

* 自动配置API代理

**dev:start命令：**

* 支持自定义端口参数

* `--port <number>`：后端端口

* `--front-port <number>`：前端端口

* `--data-path <path>`：数据存储路径

## 4. 生产模式部署

### 4.1 静态文件服务

后端Express服务器提供静态文件服务，统一处理前后端请求。

### 4.2 路由分发

| 请求类型  | 路径         | 处理方式         |
| ----- | ---------- | ------------ |
| API请求 | /api/\*    | 后端API处理      |
| 静态资源  | /assets/\* | 静态文件服务       |
| 页面路由  | /\*        | 返回index.html |

### 4.3 构建流程

构建步骤：

1. 编译后端TypeScript
2. 构建前端生产版本
3. 复制前端构建产物到后端目录

### 4.4 部署命令

**start:web命令：**

* 构建并启动完整Web服务

**start命令：**

* 启动已构建的生产服务

* `--port <number>`：服务端口（默认3000）

* `--data-path <path>`：数据存储路径

## 5. 配置参数

### 5.1 参数规范

| 参数类型 | 格式                   | 示例                 |
| ---- | -------------------- | ------------------ |
| 端口   | --port, --front-port | --port 3000        |
| 路径   | --data-path          | --data-path ./data |

### 5.2 参数传递

所有配置参数通过命令行传递给应用程序，避免使用环境变量。

## 6. 实施计划

### 6.1 开发阶段

**第一阶段：前端API集成（2天）**

* 创建API服务类

* 集成前端页面数据获取

* 配置Vite代理

**第二阶段：开发模式启动（1天）**

* 开发并发启动脚本

* 实现参数解析

**第三阶段：生产模式部署（1天）**

* 配置静态文件服务

* 开发构建脚本

## 7. 使用指南

### 7.1 开发环境

**默认启动：**

```
npm run dev:web
```

**自定义启动：**

```
npm run dev:start -- --port 8080 --front-port 3000 --data-path ./dev-data
```

### 7.2 生产环境

**完整部署：**

```
npm run start:web -- --port 80 --data-path /var/app/data
```

**分步部署：**

```
npm run build:all
npm run start -- --port 80 --data-path /var/app/data
```

## 8. 核心特性

* **命令行配置**：所有参数通过命令行传递

* **统一服务**：生产模式下前后端统一部署

* **代理转发**：开发模式下自动配置API代理

* **简单部署**：一条命令完成构建和启动

