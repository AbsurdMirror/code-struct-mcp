# TESTMOD002. 模块管理模块

## 基本信息

### 模块ID
TESTMOD002

### 模块名
模块管理模块测试

### 模块描述
对MOD002模块管理模块的所有函数进行测试验证，确保模块的创建、读取、更新、删除和关系管理功能的正确性。

## 测试用例

### TESTCASE001. add_module函数测试
- **测试用例名**: add_module函数测试
- **测试目标**: MOD002.FUNC001
- **测试用例描述**: 测试模块添加功能，包括正常添加、格式验证、重复检查、循环引用检测等场景
- **测试步骤**:
  1. 准备有效的Module对象，包含name、hierarchical_name、type、description等必需字段
  2. 调用add_module(module)函数
  3. 检查返回结果success是否为true
  4. 验证模块是否正确添加到缓存中
  5. 测试重复添加相同hierarchical_name的模块
  6. 验证返回错误信息"模块已存在"
  7. 测试添加包含无效name格式的模块（如以数字开头）
  8. 验证返回相应的格式错误信息
  9. 测试添加包含无效hierarchical_name格式的模块
  10. 验证返回相应的格式错误信息
  11. 测试添加包含不支持的type的模块
  12. 验证返回"不支持的模块类型"错误
  13. 测试添加包含循环引用的模块（parent指向自身）
  14. 验证返回"模块不能引用自身作为父模块"错误
  15. 测试添加超过5层嵌套深度的模块
  16. 验证返回"模块嵌套深度不能超过5层"错误
- **测试结果**:
  - 预期结果1：有效模块添加成功，返回success=true
  - 预期结果2：重复模块添加失败，返回相应的错误信息
  - 预期结果3：格式错误模块添加失败，返回相应的错误信息
  - 预期结果4：循环引用模块添加失败，返回相应的错误信息
  - 预期结果5：超深度模块添加失败，返回相应的错误信息

### TESTCASE002. find_modules函数测试
- **测试用例名**: find_modules函数测试
- **测试目标**: MOD002.FUNC002
- **测试用例描述**: 测试模块查找功能，包括精确查找、类型筛选、关键字搜索等场景
- **测试步骤**:
  1. 预先添加多个不同类型的测试模块
  2. 调用find_modules({hierarchical_name: "精确名称"})进行精确查找
  3. 验证返回的模块列表包含正确的模块
  4. 调用find_modules({type: "class"})按类型查找
  5. 验证返回的模块列表只包含class类型的模块
  6. 调用find_modules({keyword: "测试关键字"})按关键字查找
  7. 验证返回的模块列表包含name或description中包含关键字的模块
  8. 调用find_modules({type: "function", keyword: "函数"})组合条件查找
  9. 验证返回的模块列表同时满足类型和关键字条件
  10. 调用find_modules({})不传任何条件
  11. 验证返回所有模块
  12. 测试查找不存在的hierarchical_name
  13. 验证返回空列表
- **测试结果**:
  - 预期结果1：精确查找返回匹配的模块
  - 预期结果2：类型筛选返回指定类型的模块
  - 预期结果3：关键字搜索返回包含关键字的模块
  - 预期结果4：组合条件查找返回同时满足所有条件的模块
  - 预期结果5：无条件查找返回所有模块
  - 预期结果6：查找不存在的模块返回空列表

### TESTCASE003. update_module函数测试
- **测试用例名**: update_module函数测试
- **测试目标**: MOD002.FUNC003
- **测试用例描述**: 测试模块更新功能，包括正常更新、权限验证、错误处理等场景
- **测试步骤**:
  1. 预先添加一个测试模块
  2. 调用update_module(hierarchical_name, {description: "新描述"})更新描述
  3. 验证返回success=true，描述被正确更新
  4. 调用update_module(hierarchical_name, {parent: "新父模块"})更新父模块
  5. 验证父模块被正确更新
  6. 尝试更新不存在的模块
  7. 验证返回"模块不存在"错误
  8. 尝试更新hierarchical_name字段
  9. 验证返回"不允许修改模块的hierarchical_name"错误
  10. 尝试更新name字段
  11. 验证返回"不允许修改模块的name"错误
  12. 尝试更新type字段
  13. 验证返回"不允许修改模块类型"错误
  14. 测试更新多个字段同时进行
  15. 验证所有字段都被正确更新
- **测试结果**:
  - 预期结果1：正常更新成功，返回success=true
  - 预期结果2：更新不存在模块失败，返回相应的错误信息
  - 预期结果3：尝试修改关键字段失败，返回相应的错误信息
  - 预期结果4：多字段同时更新成功

### TESTCASE004. delete_module函数测试
- **测试用例名**: delete_module函数测试
- **测试目标**: MOD002.FUNC004
- **测试用例描述**: 测试模块删除功能，包括正常删除、依赖检查、错误处理等场景
- **测试步骤**:
  1. 预先添加一个独立的测试模块
  2. 调用delete_module(hierarchical_name)删除模块
  3. 验证返回success=true，模块被正确删除
  4. 预先添加一个包含子模块的父模块
  5. 尝试删除该父模块
  6. 验证返回"模块包含子模块，无法删除"错误
  7. 预先添加一个被其他模块引用的模块
  8. 尝试删除该被引用模块
  9. 验证返回"模块被引用，无法删除"错误
  10. 尝试删除不存在的模块
  11. 验证返回"模块不存在"错误
  12. 验证删除操作后相关关系数据也被正确清理
- **测试结果**:
  - 预期结果1：独立模块删除成功
  - 预期结果2：包含子模块的模块删除失败
  - 预期结果3：被引用的模块删除失败
  - 预期结果4：删除不存在模块失败
  - 预期结果5：删除后关系数据正确清理

### TESTCASE005. get_module_types函数测试
- **测试用例名**: get_module_types函数测试
- **测试目标**: MOD002.FUNC005
- **测试用例描述**: 测试获取模块类型列表功能
- **测试步骤**:
  1. 调用get_module_types()函数
  2. 验证返回的类型列表包含所有支持的类型：class、function、variable、file、functionGroup
  3. 验证返回的是类型列表的副本（不是原数组的引用）
  4. 多次调用函数验证返回结果的一致性
- **测试结果**:
  - 预期结果1：返回包含所有支持类型的列表
  - 预期结果2：返回的是副本，不影响原数据
  - 预期结果3：多次调用结果一致

### TESTCASE006. get_module_relationships函数测试
- **测试用例名**: get_module_relationships函数测试
- **测试目标**: MOD002.FUNC006
- **测试用例描述**: 测试获取模块关系信息功能
- **测试步骤**:
  1. 预先创建具有父子关系和引用关系的模块
  2. 调用get_module_relationships(存在模块的hierarchical_name)
  3. 验证返回的ModuleRelationship包含正确的children和references信息
  4. 调用get_module_relationships(不存在模块的hierarchical_name)
  5. 验证返回默认值{hierarchical_name, children: [], references: []}
  6. 验证返回的关系数据与实际模块关系一致
  7. 测试获取根模块的关系信息
  8. 验证返回正确的子模块列表
- **测试结果**:
  - 预期结果1：存在模块返回正确的关系信息
  - 预期结果2：不存在模块返回默认关系信息
  - 预期结果3：关系数据与实际模块关系一致
  - 预期结果4：根模块关系信息正确

### TESTCASE007. 综合功能测试
- **测试用例名**: 综合功能测试
- **测试目标**: MOD002.FUNC001-FUNC006
- **测试用例描述**: 测试模块管理模块的完整工作流程
- **测试步骤**:
  1. 创建多个具有层级关系的模块
  2. 验证所有模块添加成功
  3. 使用不同条件查找模块
  4. 验证查找结果正确
  5. 更新部分模块的信息
  6. 验证更新成功且不影响其他模块
  7. 获取模块关系信息
  8. 验证关系信息正确反映模块间的层级和引用关系
  9. 删除叶子节点模块
  10. 验证删除成功且关系信息更新
  11. 尝试删除仍有依赖的模块
  12. 验证删除被正确阻止
  13. 验证整个过程中数据的一致性和完整性
- **测试结果**:
  - 预期结果1：完整CRUD操作流程执行成功
  - 预期结果2：模块关系维护正确
  - 预期结果3：数据一致性和完整性得到保证
  - 预期结果4：错误处理机制有效工作