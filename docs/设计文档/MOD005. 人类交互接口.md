# MOD005. 人类交互接口

## 基本信息

### 模块ID
MOD005

### 模块名
人类交互接口

### 模块描述
为人类用户提供基于HTTP的Web接口，通过RESTful API方式实现模块的CRUD操作。支持获取根模块列表、按层次名称查询模块、以及完整的增删改查功能。

## 依赖模块
- MOD001. 数据存储模块
- MOD002. 模块管理模块
- MOD003. 查询引擎模块

## 接口URL设计

| URL路径 | HTTP方法 | 功能描述 | 对应函数 |
|---|---|---|---|
| `/api/modules` | GET | 获取根模块列表 | FUNC001 |
| `/api/modules/{hierarchical_name}` | GET | 按层次名称获取模块信息 | FUNC002 |
| `/api/modules/search` | GET | 关键词搜索模块 | FUNC003 |
| `/api/modules` | POST | 添加新模块 | FUNC004 |
| `/api/modules/{hierarchical_name}` | PUT | 修改模块信息 | FUNC005 |
| `/api/modules/{hierarchical_name}` | DELETE | 删除模块 | FUNC006 |

### 接口详细说明

#### 1. 获取根模块列表
- **HTTP方法**: GET
- **URL**: `/api/modules`
- **请求参数**: 无
- **响应参数**:
  - `success`: boolean - 操作是否成功
  - `data`: Module[] - 根模块列表
  - `message`: string - 提示信息
- **状态码**:
  - 200: 成功
  - 500: 服务器错误

#### 2. 按层次名称获取模块信息
- **HTTP方法**: GET
- **URL**: `/api/modules/{hierarchical_name}`
- **路径参数**:
  - `hierarchical_name`: string - 模块层次名称（必需）
- **响应参数**:
  - `success`: boolean - 操作是否成功
  - `data`: Module - 模块详细信息
  - `message`: string - 提示信息
- **状态码**:
  - 200: 成功
  - 404: 模块未找到
  - 500: 服务器错误

#### 3. 关键词搜索模块
- **HTTP方法**: GET
- **URL**: `/api/modules/search`
- **查询参数**:
  - `keyword`: string - 搜索关键词（必需）
  - `type`: string - 模块类型（可选）
  - `limit`: number - 返回数量限制，默认20（可选）
  - `offset`: number - 结果偏移量，默认0（可选）
- **响应参数**:
  - `success`: boolean - 操作是否成功
  - `data`: Module[] - 匹配的模块列表
  - `message`: string - 提示信息
- **状态码**:
  - 200: 成功
  - 400: 参数错误
  - 500: 服务器错误

#### 4. 添加新模块
- **HTTP方法**: POST
- **URL**: `/api/modules`
- **请求体**: ModuleRequest对象
  - `name`: string - 模块名称（必需）
  - `type`: string - 模块类型（必需）
  - `description`: string - 模块描述（可选）
  - `content`: string - 模块内容（可选）
  - `parent`: string - 父模块层次名称（可选）
- **响应参数**:
  - `success`: boolean - 操作是否成功
  - `data`: Module - 新创建的模块
  - `message`: string - 提示信息
- **状态码**:
  - 201: 创建成功
  - 400: 参数错误
  - 409: 模块已存在
  - 500: 服务器错误

#### 5. 修改模块信息
- **HTTP方法**: PUT
- **URL**: `/api/modules/{hierarchical_name}`
- **路径参数**:
  - `hierarchical_name`: string - 模块层次名称（必需）
- **请求体**: ModuleRequest对象（不包含name和type字段）
  - `description`: string - 模块描述（可选）
  - `content`: string - 模块内容（可选）
  - `parent`: string - 父模块层次名称（可选）
- **响应参数**:
  - `success`: boolean - 操作是否成功
  - `data`: Module - 更新后的模块
  - `message`: string - 提示信息
- **状态码**:
  - 200: 更新成功
  - 400: 参数错误
  - 404: 模块未找到
  - 500: 服务器错误

#### 6. 删除模块
- **HTTP方法**: DELETE
- **URL**: `/api/modules/{hierarchical_name}`
- **路径参数**:
  - `hierarchical_name`: string - 模块层次名称（必需）
- **响应参数**:
  - `success`: boolean - 操作是否成功
  - `message`: string - 提示信息
- **状态码**:
  - 200: 删除成功
  - 404: 模块未找到
  - 409: 模块有子模块或引用
  - 500: 服务器错误

## 数据结构定义

### APIResponse接口定义
| 字段名 | 类型 | 必需 | 描述 |
|---|---|---|---|
| success | boolean | 是 | 操作是否成功 |
| data | any | 否 | 返回数据 |
| message | string | 否 | 提示信息或错误详情 |

### ModuleRequest接口定义
| 字段名 | 类型 | 必需 | 描述 |
|---|---|---|---|
| name | string | 是 | 模块名称 |
| type | string | 是 | 模块类型 |
| description | string | 否 | 模块描述 |
| content | string | 否 | 模块内容 |
| parent | string | 否 | 父模块层次名称 |

### SearchQuery接口定义
| 字段名 | 类型 | 必需 | 描述 |
|---|---|---|---|
| keyword | string | 是 | 搜索关键词（匹配模块名称和描述） |
| type | 'class' \| 'function' \| 'variable' \| 'file' \| 'functionGroup' | 否 | 模块类型筛选 |
| limit | number | 否 | 返回结果数量限制，默认20 |
| offset | number | 否 | 结果偏移量，默认0 |

## 变量列表

### VAR001. request_cache
- **变量ID**: VAR001
- **变量名**: request_cache
- **变量类型**: Record<string, any>
- **变量描述**: 请求缓存，存储常用查询结果以提高响应速度

## 函数列表

### FUNC001. get_root_modules
- **函数ID**: FUNC001
- **函数名**: get_root_modules
- **参数列表**:
  - 无
- **返回值列表**:
  - modules: Module[] - 根模块列表
- **函数描述**:
  1. 检查缓存中是否存在根模块列表
  2. 调用MOD002.find_modules查询parent为空的模块
  3. 缓存查询结果
  4. 返回模块列表

### FUNC002. get_module_by_hierarchical_name
- **函数ID**: FUNC002
- **函数名**: get_module_by_hierarchical_name
- **参数列表**:
  - hierarchical_name: string - 模块层次名称
- **返回值列表**:
  - module: Module - 模块详细信息
- **函数描述**:
  1. 验证hierarchical_name格式
  2. 调用MOD002.get_module_by_name查询模块
  3. 如果模块不存在：返回404错误
  4. 返回模块详细信息

### FUNC003. search_modules
- **函数ID**: FUNC003
- **函数名**: search_modules
- **参数列表**:
  - query: SearchQuery - 搜索参数
- **返回值列表**:
  - result: APIResponse - 搜索结果
- **函数描述**:
  1. 验证query参数格式
  2. 检查缓存中是否存在搜索结果
  3. 构建SearchCriteria对象：{keyword: query.keyword, type: query.type}
  4. 调用MOD002.find_modules传入SearchCriteria执行搜索
  5. 应用limit和offset分页
  6. 缓存搜索结果
  7. 返回搜索结果

### FUNC004. add_module
- **函数ID**: FUNC004
- **函数名**: add_module
- **参数列表**:
  - module_data: ModuleRequest - 模块数据
- **返回值列表**:
  - result: APIResponse - 操作结果
- **函数描述**:
  1. 验证输入数据的完整性和格式
  2. 检查模块名称是否已存在
  3. 调用MOD002.add_module添加模块
  4. 返回操作结果

### FUNC005. update_module
- **函数ID**: FUNC005
- **函数名**: update_module
- **参数列表**:
  - hierarchical_name: string - 模块层次名称
  - update_data: ModuleRequest - 更新数据
- **返回值列表**:
  - result: APIResponse - 操作结果
- **函数描述**:
  1. 验证hierarchical_name格式
  2. 验证更新数据的格式
  3. 检查模块是否存在
  4. 调用MOD002.update_module更新模块
  5. 返回操作结果

### FUNC006. delete_module
- **函数ID**: FUNC006
- **函数名**: delete_module
- **参数列表**:
  - hierarchical_name: string - 模块层次名称
- **返回值列表**:
  - result: APIResponse - 操作结果
- **函数描述**:
  1. 验证hierarchical_name格式
  2. 检查模块是否存在
  3. 检查是否有子模块依赖
  4. 调用MOD002.delete_module删除模块
  5. 返回操作结果