# MOD002. 模块管理模块

## 基本信息

### 模块ID
MOD002

### 模块名
模块管理模块

### 模块描述
负责代码模块的创建、读取、更新和删除操作，支持多种代码元素类型的管理。维护模块之间的层级和关联关系，确保代码文档的完整性和一致性。使用层次化命名系统解决同名模块冲突问题，支持最大5层嵌套深度。

## 依赖模块
- MOD001. 数据存储模块

## 数据结构定义

### Module接口定义
| 字段名 | 类型 | 必需 | 描述 |
|---|---|---|---|
| name | string | 是 | 模块名称（非唯一标识符） |
| hierarchical_name | string | 是 | 层次化唯一标识符（点号分隔路径） |
| type | 'class' \| 'function' \| 'variable' \| 'file' \| 'functionGroup' | 是 | 模块类型 |
| description | string | 是 | 模块描述 |
| parent | string | 否 | 父模块的hierarchical_name |
| file | string | 否 | 所属文件路径 |

### ClassModule扩展字段
| 字段名 | 类型 | 必需 | 描述 |
|---|---|---|---|
| parentClass | string | 否 | 父类名称 |
| functions | string[] | 否 | 类中的函数列表 |
| variables | string[] | 否 | 类中的变量列表 |
| classes | string[] | 否 | 类中的嵌套类列表 |
| access | 'public' \| 'private' \| 'protected' | 否 | 访问权限 |

### FunctionModule扩展字段
| 字段名 | 类型 | 必需 | 描述 |
|---|---|---|---|
| parameters | Parameter[] | 是 | 函数参数列表 |
| returnType | string | 是 | 返回值类型 |
| access | 'public' \| 'private' \| 'protected' | 否 | 访问权限 |

### VariableModule扩展字段
| 字段名 | 类型 | 必需 | 描述 |
|---|---|---|---|
| dataType | string | 是 | 变量数据类型 |
| initialValue | string | 否 | 初始值 |
| access | 'public' \| 'private' \| 'protected' | 否 | 访问权限 |

### Parameter接口定义
| 字段名 | 类型 | 必需 | 描述 |
|---|---|---|---|
| name | string | 是 | 参数名称 |
| type | string | 是 | 参数类型 |
| defaultValue | string | 否 | 默认值 |
| description | string | 否 | 参数描述 |

### SearchCriteria接口定义
| 字段名 | 类型 | 必需 | 描述 |
|---|---|---|---|
| hierarchical_name | string | 否 | 精确匹配的层次化名称 |
| type | 'class' \| 'function' \| 'variable' \| 'file' \| 'functionGroup' | 否 | 模块类型 |
| keyword | string | 否 | 关键字搜索（匹配描述） |

### ModuleRelationship接口定义
| 字段名 | 类型 | 必需 | 描述 |
|---|---|---|---|
| hierarchical_name | string | 是 | 模块的hierarchical_name |
| children | string[] | 是 | 子模块的name列表 |
| references | string[] | 否 | 引用该模块的模块列表 |

## 接口列表
- add_module(module: Module) -> {success: boolean, message: string} - 新增模块
- find_modules(criteria: SearchCriteria) -> Module[] - 查找模块
- update_module(hierarchical_name: string, updates: Partial<Module>) -> {success: boolean, message: string} - 更新模块
- delete_module(hierarchical_name: string) -> {success: boolean, message: string} - 删除模块
- get_module_types() -> Array<'class' \| 'function' \| 'variable' \| 'file' \| 'functionGroup'> - 获取模块类型
- get_module_relationships(hierarchical_name: string) -> ModuleRelationship - 获取模块关系

## 变量列表

### VAR001. supported_types
- **变量ID**: VAR001
- **变量名**: supported_types
- **变量类型**: Array<'class' \| 'function' \| 'variable' \| 'file' \| 'functionGroup'>
- **变量描述**: 支持的模块类型列表

### VAR002. modules_cache
- **变量ID**: VAR002
- **变量名**: modules_cache
- **变量类型**: Record<string, Module>
- **变量描述**: 内存中的模块数据缓存，键为hierarchical_name，值为模块详情

### VAR003. relationships
- **变量ID**: VAR003
- **变量名**: relationships
- **变量类型**: Record<string, ModuleRelationship>
- **变量描述**: 模块关系映射，基于hierarchical_name

## 函数列表

### FUNC001. add_module
- **函数ID**: FUNC001
- **函数名**: add_module
- **参数列表**:
  - module: Module - 模块数据对象
- **返回值列表**:
  - success: boolean - 新增是否成功
  - message: string - 操作结果描述
- **函数描述**:
  1. CHECK module.name格式：只支持字母、数字、下划线，不能以数字开头
  2. CHECK module.hierarchical_name格式：点号分隔，每段符合name格式规范，最大深度5层
  3. CHECK module.hierarchical_name在modules_cache中是否已存在：
     - 如果存在：返回{success: false, message: `模块已存在: ${module.hierarchical_name}`}
  4. CHECK module.type是否在supported_types中：
     - 如果不在：返回{success: false, message: `不支持的模块类型: ${module.type}`}
  5. CHECK module.parent是否存在循环引用：
     - 如果module.parent等于module.hierarchical_name：返回{success: false, message: "模块不能引用自身作为父模块"}
     - 遍历parent链检查是否形成循环：如果检测到循环：返回{success: false, message: "检测到循环引用"}
  6. CHECK层次深度是否超过5层：
     - 如果超过：返回{success: false, message: "模块嵌套深度不能超过5层"}
  7. modules_cache[module.hierarchical_name] = module
  8. 更新relationships映射
  9. 调用MOD001.save_modules(modules_cache)保存数据
  10. 返回{success: true, message: "模块添加成功"}

### FUNC002. find_modules
- **函数ID**: FUNC002
- **函数名**: find_modules
- **参数列表**:
  - criteria: SearchCriteria - 查询条件对象
- **返回值列表**:
  - modules: Module[] - 匹配的模块列表
- **函数描述**:
  1. 初始化结果数组：const result: Module[] = []
  2. 如果criteria.hierarchical_name存在：
     - 直接返回modules_cache[criteria.hierarchical_name]或空数组
  3. 否则遍历Object.values(modules_cache)中的每个模块：
     - CHECK criteria.type：模块.type等于criteria.type
     - CHECK criteria.keyword：模块.name包含criteria.keyword（忽略大小写）或模块.description包含criteria.keyword（忽略大小写）
  4. 将匹配的模块添加到result数组
  5. 返回result

### FUNC003. update_module
- **函数ID**: FUNC003
- **函数名**: update_module
- **参数列表**:
  - hierarchical_name: string - 要更新的模块hierarchical_name
  - updates: Partial<Module> - 要更新的字段和值
- **返回值列表**:
  - success: boolean - 更新是否成功
  - message: string - 操作结果描述
- **函数描述**:
  1. CHECK hierarchical_name是否在modules_cache中：
     - 如果不在：返回{success: false, message: `模块不存在: ${hierarchical_name}`}
  2. CHECK updates是否包含hierarchical_name字段：
     - 如果包含：返回{success: false, message: "不允许修改模块的hierarchical_name"}
  3. CHECK updates是否包含name字段：
     - 如果包含：返回{success: false, message: "不允许修改模块的name"}
  4. CHECK updates是否包含type字段：
     - 如果包含：返回{success: false, message: "不允许修改模块类型"}
  5. Object.assign(modules_cache[hierarchical_name], updates)
  6. 调用MOD001.save_modules(modules_cache)保存数据
  7. 返回{success: true, message: "模块更新成功"}

### FUNC004. delete_module
- **函数ID**: FUNC004
- **函数名**: delete_module
- **参数列表**:
  - hierarchical_name: string - 要删除的模块hierarchical_name
- **返回值列表**:
  - success: boolean - 删除是否成功
  - message: string - 操作结果描述
- **函数描述**:
  1. CHECK hierarchical_name是否在modules_cache中：
     - 如果不在：返回{success: false, message: `模块不存在: ${hierarchical_name}`}
  2. CHECK relationships中是否有子模块：
     - 如果有子模块：返回{success: false, message: `模块包含子模块，无法删除: ${hierarchical_name}`}
  3. CHECK relationships中是否有模块引用hierarchical_name：
     - 如果有：返回{success: false, message: `模块被引用，无法删除: ${hierarchical_name}`}
  4. delete modules_cache[hierarchical_name]
  5. delete relationships[hierarchical_name]
  6. 调用MOD001.save_modules(modules_cache)保存数据
  7. 返回{success: true, message: "模块删除成功"}

### FUNC005. get_module_types
- **函数ID**: FUNC005
- **函数名**: get_module_types
- **参数列表**:
  - 无
- **返回值列表**:
  - types: Array<'class' \| 'function' \| 'variable' \| 'file' \| 'functionGroup'> - 模块类型列表
- **函数描述**:
  1. 返回supported_types的副本

### FUNC006. get_module_relationships
- **函数ID**: FUNC006
- **函数名**: get_module_relationships
- **参数列表**:
  - hierarchical_name: string - 模块hierarchical_name
- **返回值列表**:
  - relationships: ModuleRelationship - 模块关系信息
- **函数描述**:
  1. CHECK hierarchical_name是否在modules_cache中：
     - 如果不在：返回{hierarchical_name, children: [], references: []}
  2. 返回relationships[hierarchical_name]或默认值